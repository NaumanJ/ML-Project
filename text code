import numpy as np
from skimage import io, color

def compute_coarseness(image):
    """
    Compute the coarseness of an image based on Tamura's texture features.
    
    Parameters:
    image (numpy array): Input image in grayscale or RGB format.
    
    Returns:
    float: Coarseness value.
    """
    # Convert image to grayscale if it is in RGB format
    if len(image.shape) == 3:
        image = color.rgb2gray(image)
    
    # Normalize the image to the range [0, 1]
    image = image / image.max()
    
    # Define different window sizes (scales) to analyze the texture
    scales = [1, 2, 4, 8, 16]
    
    # Initialize arrays to store horizontal and vertical differences
    E_h = np.zeros((len(scales), image.shape[0], image.shape[1]))
    E_v = np.zeros((len(scales), image.shape[0], image.shape[1]))
    
    for i, scale in enumerate(scales):
        # Calculate horizontal and vertical differences for each scale
        if image.shape[0] > scale and image.shape[1] > scale:
            E_h[i, scale:-scale, scale:-scale] = np.abs(
                image[scale:-scale, 2*scale:] - image[scale:-scale, :-2*scale]
            ) / (2 * scale)
            E_v[i, scale:-scale, scale:-scale] = np.abs(
                image[2*scale:, scale:-scale] - image[:-2*scale, scale:-scale]
            ) / (2 * scale)
    
    # Compute the maximum difference for each pixel across all scales
    E = np.maximum(E_h, E_v)
    
  # Select the scale with the maximum difference for each pixel
    S_best = np.argmax(E, axis=0)
    
    # Compute the average best scale as the coarseness measure
    coarseness = np.mean(scales[S_best])
    
    return coarseness

------------------------------------------------------------------------------------------------------------
Measuring Texture Feature Coarseness
1. Input Image
Start with the input image.
2. Define Neighborhood Sizes
Define a set of neighborhood sizes ğ‘˜k (e.g., 1ğ‘¥1,2ğ‘¥2,4ğ‘¥4,â€¦1x1,2x2,4x4,â€¦).
3. Compute Local Averages
For each pixel (ğ‘–,ğ‘—)(i,j) in the image, compute the average gray level ğ´ğ‘˜(ğ‘–,ğ‘—)Akâ€‹(i,j) over neighborhoods of size 2ğ‘˜Ã—2ğ‘˜2kÃ—2k.
4. Compute Differences
For each neighborhood size ğ‘˜k:
Compute the horizontal difference ğ·â„(ğ‘–,ğ‘—,ğ‘˜)=âˆ£ğ´ğ‘˜(ğ‘–+2ğ‘˜,ğ‘—)âˆ’ğ´ğ‘˜(ğ‘–âˆ’2ğ‘˜,ğ‘—)âˆ£Dhâ€‹(i,j,k)=âˆ£Akâ€‹(i+2k,j)âˆ’Akâ€‹(iâˆ’2k,j)âˆ£.
Compute the vertical difference ğ·ğ‘£(ğ‘–,ğ‘—,ğ‘˜)=âˆ£ğ´ğ‘˜(ğ‘–,ğ‘—+2ğ‘˜)âˆ’ğ´ğ‘˜(ğ‘–,ğ‘—âˆ’2ğ‘˜)âˆ£Dvâ€‹(i,j,k)=âˆ£Akâ€‹(i,j+2k)âˆ’Akâ€‹(i,jâˆ’2k)âˆ£.
5. Determine Maximum Difference
For each pixel (ğ‘–,ğ‘—)(i,j):
Find the neighborhood size ğ‘˜k that maximizes the sum of the differences ğ·â„Dhâ€‹ and ğ·ğ‘£Dvâ€‹:ğ‘†(ğ‘–,ğ‘—)=2ğ‘˜ğ‘šğ‘ğ‘¥S(i,j)=2kmaxâ€‹
Where ğ‘˜ğ‘šğ‘ğ‘¥kmaxâ€‹ is the scale that gives the maximum ğ·â„+ğ·ğ‘£Dhâ€‹+Dvâ€‹.
6. Compute Average Coarseness
Average the values of ğ‘†(ğ‘–,ğ‘—)S(i,j) over all pixels (ğ‘–,ğ‘—)(i,j) in the image to obtain the coarseness feature ğ¹ğ‘ğ‘œğ‘ğ‘Ÿğ‘ ğ‘’Fcoarseâ€‹:ğ¹ğ‘ğ‘œğ‘ğ‘Ÿğ‘ ğ‘’=1ğ‘âˆ‘ğ‘–,ğ‘—ğ‘†(ğ‘–,ğ‘—)Fcoarseâ€‹=N1â€‹i,jâˆ‘â€‹S(i,j)
Where ğ‘N is the total number of pixels.
------------------------------------------------------------------------------------------------------------  
